version: 2

models:
  - name: int_orders_latest
    description: >
      Deduplicated orders â€” one row per order_id, keeping the row with
      the most recent updated_at timestamp. Also carries three
      was_ever_* flags aggregated across the full status history so
      downstream models can distinguish "current status" from
      "ever reached this status".
    columns:
      - name: order_id
        description: Unique order identifier (UUID, cast to string).
        tests:
          - unique
          - not_null
      - name: user_id
        description: Foreign key to stg_raw__users.
        tests:
          - not_null
      - name: currency
        description: ISO 4217 currency code of the transaction (e.g. USD, EUR).
      - name: card_country
        description: >
          ISO 3166-1 alpha-2 country code of the payment card.
          Null when payment method has no card (e.g. Airmoney).
      - name: destination_country
        description: ISO 3166-1 alpha-2 country code where the eSIM is used.
      - name: payment_method
        description: >
          Normalized payment method in snake_case
          (e.g. credit_card, apple_pay, google_pay, paypal, airmoney).
      - name: status
        description: >
          Current order status from the most recent row
          (completed, refunded, or failed).
      - name: esim_package
        description: >
          Original eSIM package label from source
          (e.g. '1GB - 7 Days', 'Unlimited').
      - name: package_data_gigabytes
        description: >
          Data allowance in GB, parsed from esim_package.
          Null for unlimited plans.
      - name: package_validity_days
        description: >
          Plan validity in days, parsed from esim_package.
          Null for unlimited plans.
      - name: is_unlimited_package
        description: True if the eSIM package is an unlimited data plan.
      - name: is_completed
        description: >
          True if the current (most recent) status is 'completed'.
          For historical status, see was_ever_completed.
      - name: is_refunded
        description: >
          True if the current (most recent) status is 'refunded'.
          For historical status, see was_ever_refunded.
      - name: is_failed
        description: >
          True if the current (most recent) status is 'failed'.
          For historical status, see was_ever_failed.
      - name: amount
        description: Transaction amount in local currency (numeric, not cents).
      - name: created_at
        description: Timestamp when the order was originally created.
      - name: updated_at
        description: Timestamp of the most recent status change.
